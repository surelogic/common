#  XXXXX                          XXXXX                      X
# X     X                           X
# X                                 X
# X       XX  XX  XXX XX   XXXXX    X      XXXXX   XXXXXX  XXX     XXXXX
#  XXXXX   X   X    XX  X X     X   X     X     X X    X     X    X     X
#       X  X   X    X     XXXXXXX   X     X     X X    X     X    X
#       X  X   X    X     X         X     X     X X    X     X    X
# X     X  X  XX    X     X     X   X   X X     X  XXXXX     X    X     X
#  XXXXX    XX XX XXXXX    XXXXX  XXXXXXX  XXXXX       X   XXXXX   XXXXX
#                                                      X
#                                                  XXXX
#
# Default query bank file.

#------------------------------------------------------------------------
# Numbered Queries
#
# Please keep in numerical order
#------------------------------------------------------------------------
query.00001=select PROJECT from PROJECT_OVERVIEW order by PROJECT
query.00002=select C.NAME, T.NAME, T.SHORT_MESSAGE, T.UUID from FINDING_TYPE T, FINDING_CATEGORY C where T.CATEGORY_ID = C.ID and T.ID in (select FINDING_TYPE_ID from ARTIFACT_TYPE, TOOL where TOOL_ID = TOOL.ID and TOOL.NAME != 'Checkstyle') order by 1,2,3
query.00003=select distinct T.NAME, A.MNEMONIC, A.LINK, A.CATEGORY from FINDING_TYPE F, ARTIFACT_TYPE A, TOOL T where T.ID=A.TOOL_ID and F.ID=A.FINDING_TYPE_ID and F.UUID='%s'
query.00004=select INFO from FINDING_TYPE where UUID='%s'
#query.00005=select FO.SUMMARY, FO.IMPORTANCE, FO.FINDING_ID, FO.PROJECT, FO.PACKAGE, FO.CLASS, FO.LINE_OF_CODE, FO.FINDING_TYPE, FO.CATEGORY, FO.TOOL, FO.ASSURANCE_TYPE from FINDINGS_OVERVIEW FO %s order by case when FO.IMPORTANCE='Irrelevant' then 5 when FO.IMPORTANCE='Low' then 4 when FO.IMPORTANCE='Medium' then 3 when FO.IMPORTANCE='High' then 2 when FO.IMPORTANCE='Critical' then 1 end, FO.SUMMARY
#query.00006=select FO.%s, count(*) from FINDINGS_OVERVIEW FO %s group by %s
query.00007=create table VERSION (N INT NOT NULL)
query.00008=drop table VERSION
query.00009=select N from VERSION
query.00010=insert into VERSION values (0)
query.00011=update VERSION set N=%d
query.00012=select S.SCHEMANAME "SCHEMA", T.TABLENAME "TABLE NAME" from SYS.SYSTABLES T, SYS.SYSSCHEMAS S where T.SCHEMAID = S.SCHEMAID order by 1,2
query.00013=select C.COLUMNNAME "COLUMN NAME", C.COLUMNDATATYPE "TYPE NAME" from SYS.SYSCOLUMNS C, SYS.SYSTABLES T, SYS.SYSSCHEMAS S where C.REFERENCEID=T.TABLEID and T.SCHEMAID=S.SCHEMAID and T.TABLENAME='%s' and S.SCHEMANAME='%s' order by C.COLUMNNUMBER
query.00014=select T.NAME, A.MESSAGE, CU.PACKAGE_NAME, SL.CLASS_NAME, SL.LINE_OF_CODE, SL.END_LINE_OF_CODE, SL.LOCATION_TYPE, SL.IDENTIFIER from ARTIFACT A, ARTIFACT_TYPE ART, TOOL T, SOURCE_LOCATION SL, COMPILATION_UNIT CU where A.ID=%d and ART.ID=A.ARTIFACT_TYPE_ID and T.ID=ART.TOOL_ID and SL.ID=A.PRIMARY_SOURCE_LOCATION_ID and CU.ID=SL.COMPILATION_UNIT_ID
query.00015=select CU.PACKAGE_NAME, SL.CLASS_NAME, SL.LINE_OF_CODE, SL.END_LINE_OF_CODE, SL.LOCATION_TYPE, SL.IDENTIFIER from ARTIFACT_SOURCE_LOCATION_RELTN ASLR, SOURCE_LOCATION SL, COMPILATION_UNIT CU where ASLR.ARTIFACT_ID=%d and SL.ID=ASLR.SOURCE_LOCATION_ID and CU.ID=SL.COMPILATION_UNIT_ID
query.00016=select A.FINDING_ID, SU.USER_NAME, A.EVENT, A.VALUE, A.DATE_TIME from SIERRA_AUDIT A left outer join SIERRA_USER SU on SU.ID = A.USER_ID where FINDING_ID=%d order by A.DATE_TIME
query.00017=select P.NAME, S.DATE_TIME, S.COMMIT_COUNT, S.UPDATE_COUNT from SYNCH S, PROJECT P where P.ID = S.PROJECT_ID order by 2 desc, 1
query.00018=delete from FIELD where RUN = ? and ID in (select ID from FIELD where RUN = ? except select FIELD from ACCESS where RUN = ?)
query.00019=delete from OBJECT where RUN=? and ID=?
query.00020=insert into RUN (Name, RawDataVersion, UserName, JavaVersion, JavaVendor, OsName, OsArch, OsVersion, MaxMemoryMB, Processors, Started) values (?,?,?,?,?,?,?,?,?,?,?)
query.00021=select * from RUN where Name=? and Started=?
query.00022=select * from RUN where Run=?
query.00023=select * from RUN
query.00024=delete from %s where Run=%d

#------------------------------------------------------------------------
# Finder queries
#------------------------------------------------------------------------

FindingsSelectionView.show=select FO.SUMMARY, FO.IMPORTANCE, FO.FINDING_ID, FO.PROJECT, FO.PACKAGE, FO.CLASS, FO.LINE_OF_CODE, FO.FINDING_TYPE, FO.CATEGORY, FO.TOOL, FO.ASSURANCE_TYPE from FINDINGS_OVERVIEW FO %s order by case when FO.IMPORTANCE='Irrelevant' then 5 when FO.IMPORTANCE='Low' then 4 when FO.IMPORTANCE='Medium' then 3 when FO.IMPORTANCE='High' then 2 when FO.IMPORTANCE='Critical' then 1 end, FO.SUMMARY
FindingsSelectionView.count=select %s, count(*) from FINDINGS_OVERVIEW FO %s group by %s

FindingsSelectionView.showJoin=select FJ.SUMMARY, FJ.IMPORTANCE, FJ.FINDING_ID, FJ.PROJECT, FJ.PACKAGE, FJ.CLASS, FJ.LINE_OF_CODE, FJ.FINDING_TYPE, FJ.CATEGORY, FJ.TOOL, FJ.ASSURANCE_TYPE from FINDINGS_OVERVIEW FO, FINDINGS_OVERVIEW FJ %s order by case when FJ.IMPORTANCE='Irrelevant' then 5 when FJ.IMPORTANCE='Low' then 4 when FJ.IMPORTANCE='Medium' then 3 when FJ.IMPORTANCE='High' then 2 when FJ.IMPORTANCE='Critical' then 1 end, FJ.SUMMARY
FindingsSelectionView.countJoin=select %s, count(*) from FINDINGS_OVERVIEW FO, FINDINGS_OVERVIEW FJ %s group by %s

FindingsSelectionView.countModels=select %s, count(*), max(FO.ASSURANCE_TYPE), max(FO.FINDING_TYPE), max(FO.SUMMARY) from FINDINGS_OVERVIEW FO, FINDINGS_OVERVIEW FJ %s group by %s


#------------------------------------------------------------------------
# Named Queries
#------------------------------------------------------------------------
portal.finding.byId=SELECT F.ID,F.IMPORTANCE,F.SUMMARY,FT.NAME,FC.NAME,P.NAME,LM.PACKAGE_NAME,LM.CLASS_NAME FROM FINDING F, LOCATION_MATCH LM, FINDING_TYPE FT, FINDING_CATEGORY FC, PROJECT P WHERE F.ID = ? AND LM.FINDING_ID = F.ID AND FT.ID = LM.FINDING_TYPE_ID AND FC.ID = FT.CATEGORY_ID AND P.ID = LM.PROJECT_ID
portal.finding.byUuid=SELECT F.ID,F.IMPORTANCE,F.SUMMARY,FT.NAME,FC.NAME,P.NAME,LM.PACKAGE_NAME,LM.CLASS_NAME FROM FINDING F, LOCATION_MATCH LM, FINDING_TYPE FT, FINDING_CATEGORY FC, PROJECT P WHERE F.UUID = ? AND LM.FINDING_ID = F.ID AND FT.ID = LM.FINDING_TYPE_ID AND FC.ID = FT.CATEGORY_ID AND P.ID = LM.PROJECT_ID
portal.finding.auditsById=SELECT A.EVENT, A.VALUE, A.DATE_TIME, U.USER_NAME FROM SIERRA_AUDIT A, SIERRA_USER U WHERE FINDING_ID = ? AND U.ID = A.USER_ID ORDER BY A.DATE_TIME
portal.finding.artifactsById=SELECT S.SCAN_DATE_TIME, T.NAME, ART.MNEMONIC_DISPLAY, A.MESSAGE \
	FROM ARTIFACT_FINDING_RELTN AFR, ARTIFACT A, ARTIFACT_TYPE ART, TOOL T, SCAN S \
	WHERE AFR.FINDING_ID = ? AND A.ID = AFR.ARTIFACT_ID AND ART.ID = A.ARTIFACT_TYPE_ID AND T.ID = ART.TOOL_ID AND S.ID = A.SCAN_ID \
	ORDER BY S.SCAN_DATE_TIME DESC
#------------------------------------------------------------------------
# Revision
#------------------------------------------------------------------------
Revision.maxRevision=SELECT MAX(REVISION) FROM REVISION

#------------------------------------------------------------------------
# Finding Relations
#------------------------------------------------------------------------
FindingRelationOverview.listForParent=SELECT PARENT_FINDING_ID,CHILD_FINDING_ID,PROJECT_ID,RELATION_TYPE,STATUS from FINDING_RELATION_OVERVIEW where PARENT_FINDING_ID = ?
FindingRelationOverview.listForChild=SELECT PARENT_FINDING_ID,CHILD_FINDING_ID,PROJECT_ID,RELATION_TYPE,STATUS from FINDING_RELATION_OVERVIEW where CHILD_FINDING_ID = ?

#------------------------------------------------------------------------
# Definitional Data
#------------------------------------------------------------------------
Definitions.insertDefinition=INSERT INTO SERVER_DEFINITION_RELTN (DEFINITION_UUID,SERVER_UUID) VALUES (?,?)
Definitions.deleteDefinition=DELETE FROM SERVER_DEFINITION_RELTN WHERE DEFINITION_UUID = ?
Definitions.getDefinitionServer=SELECT SERVER_UUID FROM SERVER_DEFINITION_RELTN WHERE DEFINITION_UUID = ?

#------------------------------------------------------------------------
# Finding Types
#------------------------------------------------------------------------
FindingTypes.findByUid=SELECT ID,UUID,NAME,SHORT_MESSAGE,INFO FROM FINDING_TYPE WHERE UUID = ?
FindingTypes.findById=SELECT ID,UUID,NAME,SHORT_MESSAGE,INFO FROM FINDING_TYPE WHERE ID = ?
FindingTypes.findArtifactTypeById=SELECT ART.ID,T.NAME,ART.MNEMONIC FROM ARTIFACT_TYPE ART, TOOL T WHERE ART.FINDING_TYPE_ID = ? AND T.ID = ART.TOOL_ID
FindingTypes.listFindingTypes=SELECT UUID FROM FINDING_TYPE
FindingTypes.scanFiltersIncluding=SELECT S.UUID,S.NAME FROM SETTING_FILTERS SF, SETTINGS S WHERE SF.FINDING_TYPE_ID = ? AND S.ID = SF.SETTINGS_ID AND SF.FILTERED = 'N'
FindingTypes.categoriesReferencing=SELECT FS.UUID,FS.NAME,FS.INFO,FE.FILTERED FROM FILTER_ENTRY FE, FILTER_SET FS WHERE FE.FINDING_TYPE_ID = ? AND FS.ID = FE.FILTER_SET_ID
FindingTypes.excludingCategories=SELECT * FROM SETTING_FILTERS WHERE FINDING_TYPE_ID = ? AND FILTERED = 'Y'
FindingTypes.query=SELECT UUID,NAME FROM FINDING_TYPE WHERE NAME LIKE ? ORDER BY NAME

#------------------------------------------------------------------------
# Projects
#------------------------------------------------------------------------
Projects.query=SELECT NAME FROM PROJECT WHERE NAME LIKE ? ORDER BY NAME
Projects.listProjects=SELECT P.NAME,S.UUID FROM PROJECT P \
   LEFT OUTER JOIN SETTINGS_PROJECT_RELTN SPR ON SPR.PROJECT_NAME = P.NAME \
   LEFT OUTER JOIN SETTINGS S ON S.ID = SPR.SETTINGS_ID 
Projects.deleteScanFilter=DELETE FROM SETTINGS_PROJECT_RELTN WHERE PROJECT_NAME = ?
Projects.insertScanFilter=INSERT INTO SETTINGS_PROJECT_RELTN (PROJECT_NAME, SETTINGS_ID) VALUES (?,(SELECT ID FROM SETTINGS WHERE UUID = ?))

#------------------------------------------------------------------------
# Scans
#------------------------------------------------------------------------
Scans.projectScans=SELECT S.UUID, SU.USER_NAME, P.NAME, S.JAVA_VERSION, S.JAVA_VENDOR, S.SCAN_DATE_TIME, S.STATUS, S.IS_PARTIAL \
     FROM SCAN S, PROJECT P, SIERRA_USER SU WHERE P.NAME = ? AND S.PROJECT_ID = P.ID AND SU.ID = S.USER_ID \
     ORDER BY S.SCAN_DATE_TIME DESC
Scans.latestProjectScan=SELECT S.UUID, SU.USER_NAME, LS.PROJECT, S.JAVA_VERSION, S.JAVA_VENDOR, S.SCAN_DATE_TIME, S.STATUS, S.IS_PARTIAL \
     FROM SCAN S, LATEST_SCANS LS, SIERRA_USER SU WHERE LS.PROJECT = ? AND S.ID = LS.SCAN_ID AND SU.ID = S.USER_ID
Scans.scanCompilations=SELECT CU.PACKAGE_NAME,CU.CU FROM SCAN S, METRIC_CU M, COMPILATION_UNIT CU \
   WHERE S.UUID = ? AND \
         M.SCAN_ID = S.ID AND \
         CU.ID = M.COMPILATION_UNIT_ID
Scans.scanFindingDetails=SELECT S.SCAN_DATE_TIME,P.NAME,COUNT(DISTINCT SO.FINDING_ID) \
	FROM SCAN S, PROJECT P, SCAN_OVERVIEW SO \
	WHERE S.UUID = ? AND P.ID = S.PROJECT_ID \
		AND SO.SCAN_ID = S.ID \
	GROUP BY S.SCAN_DATE_TIME,P.NAME
Scans.scanMetricDetails=SELECT COUNT(DISTINCT CU.PACKAGE_NAME), COUNT(CU.ID), SUM(M.LINES_OF_CODE) \
	FROM SCAN S, METRIC_CU M, COMPILATION_UNIT CU \
	WHERE S.UUID = ? AND M.SCAN_ID = S.ID AND CU.ID = M.COMPILATION_UNIT_ID
#------------------------------------------------------------------------
# Filter Sets (Ad-Hoc Categories)
#------------------------------------------------------------------------
FilterSetRecord.generated=true
FilterSetRecord.insert=INSERT INTO FILTER_SET (UUID,REVISION,NAME,INFO) VALUES (?,?,?,?)
FilterSetRecord.select=SELECT ID,REVISION,NAME,INFO FROM FILTER_SET WHERE UUID = ?
FilterSetRecord.delete=DELETE FROM FILTER_SET WHERE ID = ?
FilterSetRecord.update=UPDATE FILTER_SET SET REVISION = ?, NAME = ?, INFO = ? WHERE ID = ?

FilterSets.latestServerRevisions=SELECT SDR.SERVER_UUID,MAX(FS.REVISION) \
   FROM FILTER_SET FS, SERVER_DEFINITION_RELTN SDR WHERE FS.UUID = SDR.DEFINITION_UUID GROUP BY SDR.SERVER_UUID
FilterSets.listServerDeletions=SELECT DEFINITION_UUID FROM DELETED_DEFINITIONS WHERE SERVER_UUID = ? AND REVISION > ? AND DEFINITION_TYPE = 'CATEGORY'
FilterSets.insertDeletedFilterSet=INSERT INTO DELETED_DEFINITIONS (DEFINITION_UUID,SERVER_UUID,REVISION,DEFINITION_TYPE) VALUES (?,?,?,'CATEGORY')
FilterSets.listServerFilterSets=SELECT FS.UUID FROM FILTER_SET FS, SERVER_DEFINITION_RELTN SDR WHERE SDR.SERVER_UUID = ? AND FS.UUID = SDR.DEFINITION_UUID
FilterSets.listFilterSets=SELECT UUID FROM FILTER_SET
FilterSets.listFilterSetFilters=SELECT FT.UUID,FE.FILTERED FROM FILTER_ENTRY FE, FINDING_TYPE FT WHERE FE.FILTER_SET_ID = ? AND FT.ID = FE.FINDING_TYPE_ID
FilterSets.listFilterSetParents=SELECT FS.UUID FROM FILTER_SET_RELTN FSR, FILTER_SET FS WHERE FSR.CHILD_ID = ? AND FS.ID = FSR.PARENT_ID
FilterSets.listFilterSetChildren=SELECT FS.UUID FROM FILTER_SET_RELTN FSR, FILTER_SET FS WHERE FSR.PARENT_ID = ? AND FS.ID = FSR.CHILD_ID
FilterSets.deleteFilterSetParents=DELETE FROM FILTER_SET_RELTN WHERE CHILD_ID = ?
FilterSets.insertFilterSetParent=INSERT INTO FILTER_SET_RELTN (CHILD_ID, PARENT_ID) VALUES (?,?)
FilterSets.findParents=SELECT PFS.UUID FROM FILTER_SET CFS, FILTER_SET PFS, FILTER_SET_RELTN FSR WHERE CFS.UUID = ? AND FSR.CHILD_ID = CFS.ID AND PFS.ID = FSR.PARENT_ID
FilterSets.deleteFilterSetEntries=DELETE FROM FILTER_ENTRY WHERE FILTER_SET_ID = ?
FilterSets.insertFilterSetEntry=INSERT INTO FILTER_ENTRY (FILTER_SET_ID, FINDING_TYPE_ID, FILTERED) VALUES (?,(SELECT MAX(ID) FROM FINDING_TYPE WHERE UUID = ?), ?)
FilterSets.query=SELECT UUID,NAME FROM FILTER_SET WHERE NAME LIKE ? ORDER BY NAME
FilterSets.scanFiltersUsing=SELECT S.UUID, S.NAME FROM SETTING_FILTER_SETS SF, SETTINGS S WHERE SF.FILTER_SET_ID = ? AND S.ID = SF.SETTINGS_ID
#------------------------------------------------------------------------
# Scan Filters
#------------------------------------------------------------------------
ScanFilterRecord.generated=true
ScanFilterRecord.insert=INSERT INTO SETTINGS (UUID,NAME,REVISION) VALUES (?,?,?)
ScanFilterRecord.select=SELECT ID,NAME,REVISION FROM SETTINGS WHERE UUID = ?
ScanFilterRecord.delete=DELETE FROM SETTINGS WHERE ID = ?
ScanFilterRecord.update=UPDATE SETTINGS SET REVISION = ?, NAME = ? WHERE ID = ?

ScanFilters.latestServerRevisions=SELECT SDR.SERVER_UUID,MAX(S.REVISION) \
   FROM SETTINGS S, SERVER_DEFINITION_RELTN SDR WHERE S.UUID = SDR.DEFINITION_UUID GROUP BY SDR.SERVER_UUID
ScanFilters.listServerDeletions=SELECT DEFINITION_UUID FROM DELETED_DEFINITIONS WHERE SERVER_UUID = ? AND REVISION > ? AND DEFINITION_TYPE = 'SCANFILTER'
ScanFilters.insertDeletedScanFilter=INSERT INTO DELETED_DEFINITIONS (DEFINITION_UUID,SERVER_UUID,REVISION,DEFINITION_TYPE) VALUES (?,?,?,'SCANFILTER')
ScanFilters.deleteTypeFilters=DELETE FROM SETTING_FILTERS WHERE SETTINGS_ID = ?
ScanFilters.deleteCategoryFilters=DELETE FROM SETTING_FILTER_SETS WHERE SETTINGS_ID = ?
ScanFilters.insertTypeFilter=INSERT INTO SETTING_FILTERS (SETTINGS_ID,FINDING_TYPE_ID,IMPORTANCE,FILTERED) VALUES (?,(SELECT MAX(ID) FROM FINDING_TYPE WHERE UUID = ?),?,?)
ScanFilters.insertCategoryFilter=INSERT INTO SETTING_FILTER_SETS (SETTINGS_ID,FILTER_SET_ID,IMPORTANCE) VALUES (?,(SELECT MAX(ID) FROM FILTER_SET WHERE UUID = ?),?)
ScanFilters.listScanFilters=SELECT UUID FROM SETTINGS
ScanFilters.listServerScanFilters=SELECT S.UUID FROM SETTINGS S, SERVER_DEFINITION_RELTN SDR WHERE S.UUID = SDR.DEFINITION_UUID AND SDR.SERVER_UUID = ?
ScanFilters.listFilterSets=SELECT FS.UUID,SFS.IMPORTANCE FROM SETTINGS S, SETTING_FILTER_SETS SFS, FILTER_SET FS WHERE S.UUID = ? AND SFS.SETTINGS_ID = S.ID AND FS.ID = SFS.FILTER_SET_ID
ScanFilters.listFilters=SELECT FT.UUID, SF.IMPORTANCE, SF.FILTERED FROM SETTINGS S, SETTING_FILTERS SF, FINDING_TYPE FT WHERE S.UUID = ? AND SF.SETTINGS_ID = S.ID AND FT.ID = SF.FINDING_TYPE_ID 
ScanFilters.selectByProject=SELECT S.UUID FROM SETTINGS S, SETTINGS_PROJECT_RELTN SP WHERE SP.PROJECT_NAME = ? AND S.ID = SP.SETTINGS_ID

#------------------------------------------------------------------------
# Server Locations
#------------------------------------------------------------------------
ServerLocations.deleteLocations=DELETE FROM SERVER_LOCATION
ServerLocations.insertLocation=INSERT INTO SERVER_LOCATION (LABEL,PROTOCOL,HOST,PORT,CONTEXT_PATH,SERVER_USER,PASSWORD) VALUES (?,?,?,?,?,?,?)
ServerLocations.listLocations=SELECT ID,LABEL,PROTOCOL,HOST,PORT,CONTEXT_PATH,SERVER_USER,PASSWORD FROM SERVER_LOCATION
ServerLocations.deleteProjects=DELETE FROM SERVER_LOCATION_PROJECT
ServerLocations.insertServerProject=INSERT INTO SERVER_LOCATION_PROJECT (SERVER_ID,PROJECT) VALUES (?,?)
ServerLocations.listServerProjects=SELECT PROJECT FROM SERVER_LOCATION_PROJECT WHERE SERVER_ID = ?

#------------------------------------------------------------------------
# Plots
#------------------------------------------------------------------------
Plots.FindingType.count=SELECT COUNT(DISTINCT LM.FINDING_ID), LS.PROJECT \
	FROM LATEST_SCANS LS  INNER JOIN SCAN_OVERVIEW S ON S.SCAN_ID = LS.SCAN_ID \
	    INNER JOIN LOCATION_MATCH LM ON LM.FINDING_ID = S.FINDING_ID \
	    INNER JOIN FINDING_TYPE FT ON FT.ID = LM.FINDING_TYPE_ID AND FT.UUID = ? \
	WHERE LS.QUALIFIER = '__ALL_SCANS__' \
	GROUP BY LS.PROJECT \
	ORDER BY LS.PROJECT 

Plots.FindingTypes.count=SELECT COUNT(DISTINCT LM.FINDING_ID), LS.PROJECT \
	FROM LATEST_SCANS LS  INNER JOIN SCAN_OVERVIEW S ON S.SCAN_ID = LS.SCAN_ID \
	    INNER JOIN LOCATION_MATCH LM ON LM.FINDING_ID = S.FINDING_ID \
	    INNER JOIN FINDING_TYPE FT ON FT.ID = LM.FINDING_TYPE_ID AND FT.UUID IN ( %s ) \
	WHERE LS.QUALIFIER = '__ALL_SCANS__' \
	GROUP BY LS.PROJECT \
	ORDER BY LS.PROJECT 
	
Plots.Project.scanFindingsByProjectAndImportance=SELECT COUNT(*), \
 CASE WHEN F.IMPORTANCE = 0 THEN 'Irrelevant' \
      WHEN F.IMPORTANCE = 1 THEN 'Low' \
      WHEN F.IMPORTANCE = 2 THEN 'Medium' \
      WHEN F.IMPORTANCE = 3 THEN 'High' \
      ELSE 'Critical' END \
   ,LS.PROJECT \
   FROM LATEST_SCANS LS, SCAN_OVERVIEW SO, FINDING F \
   WHERE LS.PROJECT IN (%s) AND \
         SO.SCAN_ID = LS.SCAN_ID AND \
         F.ID = SO.FINDING_ID AND \
         F.IMPORTANCE IN (%s) \
   GROUP BY LS.PROJECT,F.IMPORTANCE \
   ORDER BY LS.PROJECT,F.IMPORTANCE 

Plots.Project.scanFindings=SELECT COUNT(*), \
 CASE WHEN F.IMPORTANCE = 0 THEN 'Irrelevant' \
      WHEN F.IMPORTANCE = 1 THEN 'Low' \
      WHEN F.IMPORTANCE = 2 THEN 'Medium' \
      WHEN F.IMPORTANCE = 3 THEN 'High' \
      ELSE 'Critical' END \
   ,S.SCAN_DATE_TIME \
   FROM SCAN S, PROJECT P, SCAN_OVERVIEW SO, FINDING F \
   WHERE P.NAME = ? AND \
         S.PROJECT_ID = P.ID AND \
         SO.SCAN_ID = S.ID AND \
         F.ID = SO.FINDING_ID AND \
         F.IMPORTANCE != 0 \
   GROUP BY S.SCAN_DATE_TIME,F.IMPORTANCE \
   ORDER BY S.SCAN_DATE_TIME,F.IMPORTANCE 

Plots.Project.linesOfCode=SELECT SUM(M.LINES_OF_CODE) \
	FROM LATEST_SCANS S, METRIC_CU M \
	WHERE S.PROJECT = ? AND M.SCAN_ID = S.SCAN_ID

Plots.Project.linesOfCodeByPackage=SELECT CU.PACKAGE_NAME, SUM(M.LINES_OF_CODE) \
	FROM LATEST_SCANS S, METRIC_CU M, COMPILATION_UNIT CU \
	WHERE S.PROJECT = ? AND M.SCAN_ID = S.SCAN_ID AND CU.ID = M.COMPILATION_UNIT_ID \
	GROUP BY CU.PACKAGE_NAME ORDER BY CU.PACKAGE_NAME

Plots.Project.compilations=SELECT COUNT(*),\
 CASE WHEN F.IMPORTANCE = 0 THEN 'Irrelevant' \
      WHEN F.IMPORTANCE = 1 THEN 'Low' \
      WHEN F.IMPORTANCE = 2 THEN 'Medium' \
      WHEN F.IMPORTANCE = 3 THEN 'High' \
      ELSE 'Critical' END \
   ,LM.PACKAGE_NAME \
   FROM LATEST_SCANS LS, SCAN_OVERVIEW SO, LOCATION_MATCH LM, FINDING F \
   WHERE LS.PROJECT = ? AND SO.SCAN_ID = LS.SCAN_ID AND F.ID = SO.FINDING_ID AND \
   LM.FINDING_ID = SO.FINDING_ID AND F.IMPORTANCE != 0 \
   GROUP BY LM.PACKAGE_NAME,F.IMPORTANCE \
   ORDER BY LM.PACKAGE_NAME,F.IMPORTANCE 
   
Plots.Project.scanImportances=SELECT COUNT(*), \
 CASE WHEN F.IMPORTANCE = 0 THEN 'Irrelevant' \
      WHEN F.IMPORTANCE = 1 THEN 'Low' \
      WHEN F.IMPORTANCE = 2 THEN 'Medium' \
      WHEN F.IMPORTANCE = 3 THEN 'High' \
      ELSE 'Critical' END \
   ,S.SCAN_DATE_TIME \
   FROM SCAN S, SCAN_OVERVIEW SO, FINDING F \
   WHERE S.UUID IN (%s) AND \
         SO.SCAN_ID = S.ID AND \
         F.ID = SO.FINDING_ID AND \
         F.IMPORTANCE IN (%s) \
   GROUP BY S.SCAN_DATE_TIME,F.IMPORTANCE \
   ORDER BY S.SCAN_DATE_TIME,F.IMPORTANCE 

#Provide information on the findings that are different between two scans.  The query takes three scan UUIDs as arguments.
#It shows all findings in the first scan except for those in the second.  It looks up compilation information based on the 
#third scan argument
Plots.project.scanFindingsDiff=SELECT F.ID, \
        LM.PACKAGE_NAME, \
        SO.CU, \
        SO.LINE_OF_CODE, \
        FT.NAME, \
        SO.TOOL, \
        CASE WHEN F.IS_READ = 'Y' THEN 'Yes' ELSE 'No' END, \
        F.LAST_CHANGED, \
        CASE \
             WHEN F.IMPORTANCE=0 THEN 'Irrelevant' \
 	         WHEN F.IMPORTANCE=1 THEN 'Low' \
             WHEN F.IMPORTANCE=2 THEN 'Medium' \
             WHEN F.IMPORTANCE=3 THEN 'High' \
             WHEN F.IMPORTANCE=4 THEN 'Critical' \
        END, \
        SO.ARTIFACT_COUNT, \
        CASE WHEN COUNT.COUNT IS NULL THEN 0 ELSE COUNT.COUNT END, \
        F.SUMMARY, \
        LM.CLASS_NAME \
 FROM \
 	(SELECT FINDING_ID FROM SCAN_OVERVIEW WHERE SCAN_ID = (SELECT ID FROM SCAN WHERE UUID = ?) \
	EXCEPT \
	SELECT FINDING_ID FROM SCAN_OVERVIEW WHERE SCAN_ID = (SELECT ID FROM SCAN WHERE UUID = ?)) AS FINDINGS \
    INNER JOIN SCAN_OVERVIEW SO ON SO.FINDING_ID = FINDINGS.FINDING_ID \
    INNER JOIN FINDING F ON F.ID = SO.FINDING_ID \
    LEFT OUTER JOIN ( \
       SELECT \
          A.FINDING_ID "ID", COUNT(*) "COUNT" \
       FROM SIERRA_AUDIT A \
       GROUP BY A.FINDING_ID) AS COUNT ON COUNT.ID = F.ID \
    INNER JOIN LOCATION_MATCH LM ON LM.FINDING_ID = F.ID \
    INNER JOIN FINDING_TYPE FT ON FT.ID = LM.FINDING_TYPE_ID \
    INNER JOIN FINDING_CATEGORY FC ON FC.ID = FT.CATEGORY_ID \
  WHERE SO.SCAN_ID = (SELECT ID FROM SCAN WHERE UUID = ?) \
 ORDER BY LM.PACKAGE_NAME, SO.CU, SO.LINE_OF_CODE

Plots.Project.compareScans=SELECT F.ID, \
        LM.PACKAGE_NAME, \
        SO.CU, \
        SO.LINE_OF_CODE, \
        FT.NAME, \
        SO.TOOL, \
        CASE WHEN F.IS_READ = 'Y' THEN 'Yes' ELSE 'No' END, \
        F.LAST_CHANGED, \
        CASE \
             WHEN F.IMPORTANCE=0 THEN 'Irrelevant' \
 	         WHEN F.IMPORTANCE=1 THEN 'Low' \
             WHEN F.IMPORTANCE=2 THEN 'Medium' \
             WHEN F.IMPORTANCE=3 THEN 'High' \
             WHEN F.IMPORTANCE=4 THEN 'Critical' \
        END, \
        CASE \
	            WHEN EARLIER.FINDING_ID IS NOT NULL THEN 'Unchanged' \
	            ELSE 'New' \
        END, \
        SO.ARTIFACT_COUNT, \
        CASE WHEN COUNT.COUNT IS NULL THEN 0 ELSE COUNT.COUNT END, \
        F.SUMMARY, \
        LM.CLASS_NAME \
 FROM \
    SCAN S \
    INNER JOIN SCAN_OVERVIEW SO ON SO.SCAN_ID = S.ID \
    INNER JOIN FINDING F ON F.ID = SO.FINDING_ID \
    LEFT OUTER JOIN SCAN_OVERVIEW EARLIER ON EARLIER.FINDING_ID = F.ID \
    LEFT OUTER JOIN ( \
       SELECT \
          A.FINDING_ID \"ID\", COUNT(*) \"COUNT\" \
       FROM SIERRA_AUDIT A \
       GROUP BY A.FINDING_ID) AS COUNT ON COUNT.ID = F.ID \
    INNER JOIN LOCATION_MATCH LM ON LM.FINDING_ID = F.ID \
    INNER JOIN FINDING_TYPE FT ON FT.ID = LM.FINDING_TYPE_ID \
    INNER JOIN FINDING_CATEGORY FC ON FC.ID = FT.CATEGORY_ID \
 WHERE EARLIER.SCAN_ID = (SELECT ID FROM SCAN WHERE UUID = ?) AND S.UUID = ? \
 ORDER BY LM.PACKAGE_NAME, SO.CU, SO.LINE_OF_CODE

Plots.Scan.packageImportances=SELECT COUNT(*), \
 CASE WHEN F.IMPORTANCE = 0 THEN 'Irrelevant' \
      WHEN F.IMPORTANCE = 1 THEN 'Low' \
      WHEN F.IMPORTANCE = 2 THEN 'Medium' \
      WHEN F.IMPORTANCE = 3 THEN 'High' \
      ELSE 'Critical' END \
   ,LM.PACKAGE_NAME \
   FROM SCAN S, SCAN_OVERVIEW SO, LOCATION_MATCH LM, FINDING F \
   WHERE S.UUID = '%s' AND \
         SO.SCAN_ID = S.ID AND \
         LM.FINDING_ID = SO.FINDING_ID AND \
         LM.PACKAGE_NAME IN (%s) AND \
         F.ID = LM.FINDING_ID AND \
         F.IMPORTANCE IN (%s) \
   GROUP BY LM.PACKAGE_NAME,F.IMPORTANCE \
   ORDER BY LM.PACKAGE_NAME,F.IMPORTANCE
   
Plots.Scan.scanFindings=SELECT F.ID, \
        LM.PACKAGE_NAME, \
        SO.CU, \
        SO.LINE_OF_CODE, \
        FT.NAME, \
        SO.TOOL, \
        CASE WHEN F.IS_READ = 'Y' THEN 'Yes' ELSE 'No' END, \
        F.LAST_CHANGED, \
        CASE \
             WHEN F.IMPORTANCE=0 THEN 'Irrelevant' \
 	         WHEN F.IMPORTANCE=1 THEN 'Low' \
             WHEN F.IMPORTANCE=2 THEN 'Medium' \
             WHEN F.IMPORTANCE=3 THEN 'High' \
             WHEN F.IMPORTANCE=4 THEN 'Critical' \
        END, \
        SO.ARTIFACT_COUNT, \
        CASE WHEN COUNT.COUNT IS NULL THEN 0 ELSE COUNT.COUNT END, \
        F.SUMMARY \
 FROM \
    SCAN S \
    INNER JOIN SCAN_OVERVIEW SO ON SO.SCAN_ID = S.ID \
    INNER JOIN FINDING F ON F.ID = SO.FINDING_ID \
    LEFT OUTER JOIN ( \
       SELECT \
          A.FINDING_ID \"ID\", COUNT(*) \"COUNT\" \
       FROM SIERRA_AUDIT A \
       GROUP BY A.FINDING_ID) AS COUNT ON COUNT.ID = F.ID \
    INNER JOIN LOCATION_MATCH LM ON LM.FINDING_ID = F.ID \
    INNER JOIN FINDING_TYPE FT ON FT.ID = LM.FINDING_TYPE_ID \
    INNER JOIN FINDING_CATEGORY FC ON FC.ID = FT.CATEGORY_ID \
 WHERE S.UUID = '%s' AND LM.PACKAGE_NAME IN (%s) AND F.IMPORTANCE IN (%s) \
 ORDER BY LM.PACKAGE_NAME, SO.CU, SO.LINE_OF_CODE
#------------------------------------------------------------------------
#                    FLASHLIGHT
#------------------------------------------------------------------------

# Calculate and write out the set of bad publishes
LockSet.badPublishes=INSERT INTO BADPUBLISH (RUN,FIELD,RECEIVER) SELECT F.RUN,F.ID,A.RECEIVER FROM FIELD F, ACCESS A \
 WHERE F.RUN = ? AND \
       A.RUN = F.RUN AND \
       A.FIELD = F.ID AND \
       A.UNDERCONSTRUCTION = 'Y' \
 GROUP BY F.RUN,F.ID,A.RECEIVER \
 HAVING COUNT(DISTINCT A.INTHREAD) > 1
# The set of fields that have writes outside of construction and are accessed by more than one thread
LockSet.interestingFields=INSERT INTO INTERESTINGFIELD (RUN,FIELD,RECEIVER) SELECT F0.RUN,F0.ID,A.RECEIVER FROM \
(SELECT DISTINCT F.RUN "RUN", F.ID "ID",A.RECEIVER "RECEIVER" FROM FIELD F, ACCESS A \
 WHERE F.RUN = ? AND \
       A.RUN = F.RUN AND \
       A.FIELD = F.ID AND \
       F.VOLATILE = 'N' AND \
       F.FINAL = 'N' AND \
       A.UNDERCONSTRUCTION = 'N' AND \
       A.RW = 'W') AS F0, ACCESS A \
WHERE A.RUN = F0.RUN AND A.FIELD = F0.ID AND A.RECEIVER = F0.RECEIVER OR (A.RECEIVER IS NULL AND F0.RECEIVER IS NULL) \
GROUP BY F0.RUN,F0.ID, A.RECEIVER \
HAVING COUNT(DISTINCT INTHREAD) > 1
# All field accesses, and the locks that are held.  If it is a RW lock, the parent lock is provided instead
LockSet.fieldAccesses=SELECT A.TS,A.InThread, \
   CASE WHEN RW.Id IS NULL THEN D.Lock \
        ELSE RW.Id \
   END \
 FROM ACCESS A \
      INNER JOIN LOCKDURATION D ON D.InThread = A.InThread AND (A.TS BETWEEN D.Start AND D.Stop) AND State = 'HOLDING' \
      LEFT OUTER JOIN RWLOCK RW ON (RW.ReadLock = D.LOCK) OR (RW.WriteLock = D.LOCK) \
 WHERE A.Run = ? AND \
       A.Field = ? AND \
       A.Receiver = ?
#Walk over all of the held locks for a run
LockSet.lockDurations=SELECT L.InThread, \
   CASE WHEN RW.Id IS NULL THEN L.Lock \
        ELSE RW.Id \
   END, \
   L.Start, \
   L.Stop \
 FROM LOCKDURATION L LEFT OUTER JOIN RWLOCK RW ON RW.Run = L.Run AND (RW.ReadLock = L.Lock OR RW.WriteLock = L.Lock) \
 WHERE L.State = 'HOLDING' AND L.Run = ? \
 ORDER BY Start
#Walk over all of the field accesses for a run
LockSet.accesses=SELECT TS, InThread, Field, Receiver, RW, UnderConstruction FROM ACCESS WHERE Run = ? ORDER BY TS
LockSet.insertFieldLockSets=INSERT INTO FIELDLOCKSET (Run,Field,Lock) VALUES (?,?,?)
LockSet.insertInstanceLockSets=INSERT INTO FIELDINSTANCELOCKSET (Run,Field,Receiver,Lock) VALUES (?,?,?,?)
LockSet.insertStaticCounts=INSERT INTO FIELDSTATICTHREAD (Run,Thread,Field,ReadCount,WriteCount) VALUES (?,?,?,?,?)
LockSet.insertFieldCounts=INSERT INTO FIELDINSTANCETHREAD (Run,Thread,Field,Receiver,ReadCount,WriteCount,ReadUCCount, WriteUCCount) VALUES (?,?,?,?,?,?,?,?)